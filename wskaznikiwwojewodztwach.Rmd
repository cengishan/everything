---
title: "Wkaźniki społeczne województw v4"
author: "Robert Kiermasz"
date: "19 września 2019"
output:
  html_document: default
  pdf_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

#Poziom życia 

Standard życia jest związany z życiem i dotyczy wszystkich ludzi. Intuicyjnie wiadomo, że pożądany jest wysoki poziom życia dla każdego człowieka. Celem pracy będzie zgłębienie wiedzy o poziomie życia w Polsce, zarys kształtowania się warunków życia na przestrzeni lat oraz skonfrontowanie ich z poglądem o „ogólnej biedzie”. Wysnujemy następujące hipotezy badawcze i za pomocą studium przypadku sytuacji społeczno-gospodarczej naszego kraju sprawdzimy ich prawdziwość. Chcielibyśmy powiedzieć, że poziom życia w Polsce się zwiększa, a gospodarstwa domowe oraz lepiej zaspokajają swoje potrzeby konsumpcyjne. Prawdopodobnie również w Polsce występuje zróżnicowanie terytorialne poziomu życia – w niektórych województwach żyje się lepiej. Możliwe też, że uda wyróżnić w Polsce grupy województw o podobnych cechach warunków życia.


#PKB



```{r pkb2, echo=TRUE, message=FALSE, warning=FALSE}

PKBwMLN<-read.csv("DaneGus/pkb_2000_2016.csv", sep=";", dec="," ,stringsAsFactors = FALSE, encoding = "UTF-8")
plot(PKBwMLN$Wartosc~PKBwMLN$Rok, type ="l", col=3, xlab="Rok", ylab="")
kursUSD<-
c(4.1171,#2000
4.0727,#2001
3.9480,#2002
3.8283,#2003
3.7327,#2004
3.0123,#2005
3.2582,#2006
2.8830,#2007
2.4550,#2008
2.9910,#2009
2.8465,#2010
2.9822,#2011
3.4454,#2012
3.0660,#2013
3.0315,#2014
3.5725,#2015
3.9281)#2016

options(scipen=6, digits=3)
par(new = T)
plot((PKBwMLN$Wartosc/kursUSD)~PKBwMLN$Rok, type ="l", col=2, pch=16, axes=F, xlab=NA, ylab=NA)
axis(side = 4)
mtext(side = 4, line = 3, "PKB w mln USD")
legend("topleft",
       legend=c("PKB w mln PLN", "PKB w mln USD"),
       lty=c(1,1), pch=c(NA, NA), col=c("green", "red"))



```

Na wykresie powyżej przedstawiono wartość produktu krajowego brutto w Polsce w latach 2000 - 2016. PKB jest to podstawowa miara wzrostu gospodarczego. Stan gospodarki wprost wpływa na poziom życia. Nie jest to miara idealna, ale z wykresu powyżej powyżej wynika, że Polska od wielu lat notuje wzrost gospodarczy, co przekłada się na wzrost poziomu życia. Dla pogłębienia analizy PKB wyrażono go również w dolarach. Tak przełożony PKB umożliwia porównianie zmian wartości mocy polskiej gospodarki na tle pozostałych państw.

#PKB per capita

Stan gospodarki można wyrazić za pomocą produktu krajowego brutto. PKB jest łączną miarą (sumą) wielkości produkcji wytworzoną przez czynniki produkcji. Popularną miarą w literaturze również jest PKB per capita, który informuje nas jaka część PKB przypada na jednego mieszkańca. Pokazuje nam to jaka część mocy wytwórczej danej gospodarki lub jaka zdolność do zaspokajania potrzeb poprzez strumień dóbr i usług przypada na jednego obywatela. Wskaźnik ten nie jest pozbawiony wad, nie pokazuje on nierównomierności dochodów, czasu wolnego, stanu środowiska, ani satysfakcji społecznej.


```{r pkb1, echo=TRUE, message=FALSE, warning=FALSE}
setwd("C://Users//rkiermasz//Downloads//wojewodztwaR")
pkb_per_capita<-read.csv("DaneGus/pkb_per_capita_2000_2016.csv", sep=";", dec="," ,stringsAsFactors = FALSE, encoding = "UTF-8")
plot(pkb_per_capita$Wartosc~pkb_per_capita$Rok, type ="l", col=1, xlab="Rok", ylab="PKB per capita")
library(dplyr)
library(knitr)
library(kableExtra)
```


Wykres powyżej przedstawia produkt krajowy brutto podzielony przez liczbę mieszkanów. Oznacza to, że ukazano wartość całej polskiej gospodarki w stosunku do jednego mieszkańca. W ciągu kolejnych lat aż od 2000 do 2015 roku zanotowano ciągły i regularny wzrost.

#Różnice w województwach

Poziom życia dotyczy wszystkich mieszkańców jednak może być on różny w zależności od zamieszkiwanego regionu. Podstawowym podziałem regionalnym w Polsce są województwa.



```{r pkbCapita, echo=TRUE, message=FALSE, warning=FALSE}
library("sp")
library("rgdal")
poland.map <- readOGR(dsn="wojewodztwa", "wojewodztwa")
pkb2016<-read.csv("DaneGus/pkb_per_capita_2016_woj.csv", sep=";", dec="," ,stringsAsFactors = FALSE, encoding = "UTF-8", colClasses = c("character","character","character","numeric","numeric","character","character","numeric"))
Kod<-poland.map@data$JPT_KOD_JE
Kod<-data.frame(Kod)
Kod<-Kod%>%left_join(pkb2016[,c(1,2,5)], by=c("Kod"="Kod"))
poland.map@data$Wartosc<-Kod$Wartosc


library(ggplot2)
q <- cut(poland.map@data$Wartosc, 
         breaks= c(quantile(poland.map@data$Wartosc)), 
         include.lowest=T, 
         dig.lab=nchar(max(poland.map@data$Wartosc)))
clr <- as.character(factor(q, labels = c("red1","coral1","darkolivegreen1","green2")))
plot(poland.map, col = clr)
title("PKB per capita w województwach w Polsce")
legend(legend = paste0(levels(q)[1:4]), fill = c("red1","coral1","darkolivegreen1","green2"), "bottomleft")

```

Porównano województwa w Polsce na podstawie poziomu PKB per capita. Celem takiego zestawienia jest ukazanie różnic terytorialnych w Polsce. Najwyższym PKB per capita charakteryzuje się województwo Mazowieckie. Wysokim poziomem PKB per capita charakteryzuje się również województwo dolnośląskie, wielkopolskie oraz śląskie. Województwa ściany wschodniej charakteryzują się najniższym poziomem PKB per capita, a tym samym można powiedzieć, że są najuboższe w Polsce.


#Województwa w Polsce

Równość społeczna jest ważnym wyznacznikiem poziomu życia. Województwa w Polsce w zależności od regionu różnią sie gospodarczo. Jednak dochód nie jest jedynym wyznacznikiem poziomu życia. Ważnym elementem życia społecznego i poziomu są także inne obszary życia. W tej pracy badanę będa kategorie tj. finanse, wyżywienie, edukacja, bezpieczeństwo mieszkańców, stan środowiska naturalnego.


```{r dane i standaryzacja, echo=TRUE, message=FALSE, warning=FALSE}
#setwd("C://Users//rkiermasz//Downloads//wojewodztwaR//wojewodztwaR")
# setwd("/home/cengu/Pobrane/wojewodztwaR/")
wojewodztwa<-read.csv("wojewodztwa2016.csv", sep=";", dec="," ,stringsAsFactors = FALSE,encoding="UTF-8")
rownames(wojewodztwa)<-wojewodztwa[,1]
wojewodztwa<-wojewodztwa[,-1]
wojewodztwa%>%kable(full_width = F)%>%kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

Zebrano dane dotyczące podstawowych wskaźników społeczno-ekonomicznych. Tabela powyżej przedstawia te wartości tych wskaźników. Ich wielkość będziemy analizować w dalszej części opracowania.

```{r opis zmiennych, echo=TRUE, message=FALSE, warning=FALSE}
charakterystyka<-read.csv("charakterystyka zmiennych.csv", sep=",", dec="," ,stringsAsFactors = FALSE,encoding="UTF-8")
charakterystyka%>%kable(full_width = F)%>%kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

Dla ułatwienia późniejszych analiz wskaźniki te zostały przypisane do kolejnych kategori: finanse, wyżywienie, edukacja,
bezpieczeństwo, środowisko.

#Standaryzacja

W celu dalszych analiz wskaźniki te zostały poddane standaryzacji Z. Standaryzacja sprowadza jednostki do wspólengo miana, co pozwala na porównanie wyników. 

```{r dane i standaryzacja2, echo=TRUE, message=FALSE, warning=FALSE}
####średnia,odchylenie,standaryzacja
srednie<-apply(wojewodztwa,2,mean)
odchylenia<-apply(wojewodztwa,2,sd)
for(i in 1:dim(wojewodztwa)[1]){
  wojewodztwa[i,]<- (wojewodztwa[i,]-srednie)/odchylenia
}
wojewodztwa%>%kable(full_width = F)%>%kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

Tabela powyżej przedstawia zestandaryzowane wskaźniki społeczno-ekonomiczne. Wskaźniki te zostały zestandaryzowane do rozkładu normalnego. Zgodnie z tablicami rozkładu normalnego kwantyl rzędu 3,99 zawiera 99,997% obserwacj, można więc założyć, że będa wskaźniki mieścić się będa w przedziale od -4 do 4. Oczywiście w badancyh danych nie ma obserwacji odstających, więc jest to zgodne z prawdą, a wszystkie wartości zestandaryzowanych wskaźników są dużo bliższe średniej.Hierarchia i stosunki kolejnych miar zostały zachowane. Tablica jest jedynie poglądowa i będzie wykorzystywana do dalszych obliczeń.

#Korelacje

Korelacje między wskaźnikami informują nas jak wysoki poziom jednej zmiennej współwystępuje wraz wysokim poziomem drugiej zmiennej. Podstawową miarą korelacji jest współczynnik korelacji liniowej pearsona.  

```{r korelacje, echo=TRUE, message=FALSE, warning=FALSE}
korelacje<-round(cor(wojewodztwa),2)
korelacje %>%data.frame %>%
  mutate(
     korelacje = row.names(.),
     f1_dochod= cell_spec(f1_dochod, "html", color = ifelse(f1_dochod> 0.7, "green", ifelse(f1_dochod< -0.7, "red", "black"))),
f2_wydatki= cell_spec(f2_wydatki, "html", color = ifelse(f2_wydatki> 0.7, "green", ifelse(f2_wydatki< -0.7, "red", "black"))),
f3_dochodWoj= cell_spec(f3_dochodWoj, "html", color = ifelse(f3_dochodWoj> 0.7, "green", ifelse(f3_dochodWoj< -0.7, "red", "black"))),
f4_alkohol= cell_spec(f4_alkohol, "html", color = ifelse(f4_alkohol> 0.7, "green", ifelse(f4_alkohol< -0.7, "red", "black"))),
f5_ubostwo= cell_spec(f5_ubostwo, "html", color = ifelse(f5_ubostwo> 0.7, "green", ifelse(f5_ubostwo< -0.7, "red", "black"))),
w1_zywnoscWydatki= cell_spec(w1_zywnoscWydatki, "html", color = ifelse(w1_zywnoscWydatki> 0.7, "green", ifelse(w1_zywnoscWydatki< -0.7, "red", "black"))),
w2_ryby= cell_spec(w2_ryby, "html", color = ifelse(w2_ryby> 0.7, "green", ifelse(w2_ryby< -0.7, "red", "black"))),
w3_owoce= cell_spec(w3_owoce, "html", color = ifelse(w3_owoce> 0.7, "green", ifelse(w3_owoce< -0.7, "red", "black"))),
w4_warzywa= cell_spec(w4_warzywa, "html", color = ifelse(w4_warzywa> 0.7, "green", ifelse(w4_warzywa< -0.7, "red", "black"))),
e1_abolwenci= cell_spec(e1_abolwenci, "html", color = ifelse(e1_abolwenci> 0.7, "green", ifelse(e1_abolwenci< -0.7, "red", "black"))),
e2_podyplomowi= cell_spec(e2_podyplomowi, "html", color = ifelse(e2_podyplomowi> 0.7, "green", ifelse(e2_podyplomowi< -0.7, "red", "black"))),
e3_doktorzy= cell_spec(e3_doktorzy, "html", color = ifelse(e3_doktorzy> 0.7, "green", ifelse(e3_doktorzy< -0.7, "red", "black"))),
b1_wypadki= cell_spec(b1_wypadki, "html", color = ifelse(b1_wypadki> 0.7, "green", ifelse(b1_wypadki< -0.7, "red", "black"))),
b2_wyp_smiertelne= cell_spec(b2_wyp_smiertelne, "html", color = ifelse(b2_wyp_smiertelne> 0.7, "green", ifelse(b2_wyp_smiertelne< -0.7, "red", "black"))),
b3_prz_kryminalne= cell_spec(b3_prz_kryminalne, "html", color = ifelse(b3_prz_kryminalne> 0.7, "green", ifelse(b3_prz_kryminalne< -0.7, "red", "black"))),
b4_prz_drogowe= cell_spec(b4_prz_drogowe, "html", color = ifelse(b4_prz_drogowe> 0.7, "green", ifelse(b4_prz_drogowe< -0.7, "red", "black"))),
b5_prz_zabojstwa= cell_spec(b5_prz_zabojstwa, "html", color = ifelse(b5_prz_zabojstwa> 0.7, "green", ifelse(b5_prz_zabojstwa< -0.7, "red", "black"))),
b6_wykrywalnosc= cell_spec(b6_wykrywalnosc, "html", color = ifelse(b6_wykrywalnosc> 0.7, "green", ifelse(b6_wykrywalnosc< -0.7, "red", "black"))),
s1_gazy= cell_spec(s1_gazy, "html", color = ifelse(s1_gazy> 0.7, "green", ifelse(s1_gazy< -0.7, "red", "black"))),
s2_pyly= cell_spec(s2_pyly, "html", color = ifelse(s2_pyly> 0.7, "green", ifelse(s2_pyly< -0.7, "red", "black"))),
s3_odpady= cell_spec(s3_odpady, "html", color = ifelse(s3_odpady> 0.7, "green", ifelse(s3_odpady< -0.7, "red", "black")))
  ) %>%
  select(korelacje,f1_dochod,f2_wydatki,f3_dochodWoj,f4_alkohol,f5_ubostwo,w1_zywnoscWydatki,w2_ryby,w3_owoce,w4_warzywa,e1_abolwenci,e2_podyplomowi,e3_doktorzy,b1_wypadki,b2_wyp_smiertelne,b3_prz_kryminalne,b4_prz_drogowe,b5_prz_zabojstwa,b6_wykrywalnosc,s1_gazy,s2_pyly,s3_odpady) %>%
  kable(format = "html", escape = F) %>%
  kable_styling("striped", full_width = F)

```


Tablica powyżej przedstawia korelacje liniowe między badanymi zmiennymi. Zmienne, które są mocno skorelowane ze sobą zaznaczono na zielono. Zmienne, które są przeciwnie skorelowane ze sobą zaznaczono na czerwono. Zaznaczono jedynie wyraźne korelacje powyżej 0.7 lub poniżej 0.7 dla wartości współczynnika korelacji. 
W badanych województwach można zauważyć wiele korelacji. W województwach o większych dochodach można było zanotować większe wydatki na żywność oraz na napoje alkoholowe i wyroby tytodniowe. Wysoki poziom dochodów oraz wydatków na żywność był odwrotnie skorelowany z procentowym udziałem gospodarstw domowych relatywnie ubogich.
W całym zbiorze jest wiele ciekawych korelacji, stanowić one będą podstawę do zbadania ogólnych różnic między województwami.

##Wykres średnich, metoda k-średnich

Jednym z badań sprawdzających zasadność różnic między podziałem na województwa o wysokim standardzie życia oraz niskim standardzie życia jest sprawdzenie różnic między grupami. W przypadku braku różnic można przyjąć hipotetycznie, że jeżeli podzielimi województwa na dwie grupy to będą one miały podobne wartości średnie pomiędzy współczynnikami.


```{r grupowanie, echo=TRUE}
wyniki<-kmeans(wojewodztwa,2)
wojewodztwa$grupa<-wyniki$cluster
srednie1<-round(apply(wojewodztwa[which(wyniki$cluster==1),-22],2,mean),2)
srednie2<-round(apply(wojewodztwa[which(wyniki$cluster==2),-22],2,mean),2)
nazwy<-names(srednie1)
tabelaSrednie<-as.data.frame(cbind(srednie1,srednie2))
tabelaSrednie<-cbind(tabelaSrednie,nazwy)
tabelaSrednie[,3]<-as.character(tabelaSrednie[,3])

library("ggplot2")
ggplot(data=tabelaSrednie, aes(nazwy))+
 geom_point(aes(y=srednie1, colour="grupa1")) + 
  geom_point(aes(y=srednie2, colour="grupa2"))+
  geom_line(aes(y=srednie1, group=1, colour="grupa1")) +
  geom_line(aes(y=srednie2, group=2, colour="grupa2")) +
  theme(text = element_text(size=18),
        axis.text.x = element_text(angle = 90, hjust = 1))

```

Za pomocą metody k-średnich podzielono województwa na dwie grupy oraz zwizualizowo średnie grupowe. Na wykresie powyżej zaprezentowano średnie poziomy współczynników przy podziale na zróżnicowane grupy. Średnie wartości zmiennych są różne dla poszczególnych grup. Jedynie dla spożycia ryb jest na podobnym poziomie. Daje to podstawy do badania województw jako różnych od siebie pod kątem poziomu życia.

#Grupowanie metodą Warda

Jedną z metod grupowania jest metoda Warda. Jest to metoda, która w pierwszej kolejności traktuje wszystkie obiekty jako całość a następnie w kolejnych iteracjach dzieli je na coraz mniejsze grupy. Wyznacznikiem podobieństwa grupowego są miary odległości euklidesowych.

```{r hclust, echo=TRUE, message=FALSE, warning=FALSE}
d <- dist(wojewodztwa,method = "euclidean")
fit <- hclust(d,method = "ward")
plot(fit, labels = rownames(wojewodztwa))

```

Metoda Warda dzieli grupy na możliwie najbardziej naturalne skupiska. Wśród badanych województw można wyróżnić 4 grupy.
Grupa 1: podlaskie, podkarpackie, lubelskie, świętokrzyskie
Grupa 2: małopolskie, wielkopolskie, kujawsko-pomorskie, warmińsko-mazurskie
Grupa 3: dolnośląskie, pomorskie, lubuskie, łódzkie, opolskie, zachodniopomorskie
Grupa 4: mazowieckie, śląskie

#Średnie w grupach

Poszczególne województwa różnia się poziomem zaspokojenia potrzeb. Współczynniki o niekorzystym wpływie przemnożono razy -1 tak aby miały ujemny wpływ na poziom zaspokojenia. Wszystkie zmienne pogrupowano i wyciągnięto z nich średnia.

```{r srednie, echo=TRUE, message=FALSE, warning=FALSE}
library(reshape2)

wojewodztwaMelt<-wojewodztwa %>% mutate(wojewodztwo = row.names(.)) %>%
  mutate(
  f5_ubostwo = f5_ubostwo*-1,
  b1_wypadki = b1_wypadki*-1,
  b2_wyp_smiertelne = b2_wyp_smiertelne*-1,
  b3_prz_kryminalne = b3_prz_kryminalne*-1,
  b4_prz_drogowe = b4_prz_drogowe*-1,
  b5_prz_zabojstwa = b5_prz_zabojstwa*-1,
  b6_wykrywalnosc = b6_wykrywalnosc*-1,
  s1_gazy = s1_gazy*-1,
  s2_pyly = s2_pyly*-1,
  s3_odpady = s3_odpady*-1 )   %>%
  mutate(
    grupa = case_when(
      wojewodztwo %in% c("PODLASKIE", "PODKARPACKIE", "LUBELSKIE", "ŚWIĘTOKRZYSKIE") ~ "Grupa 1",
      wojewodztwo %in% c("MAŁOPOLSKIE", "WIELKOPOLSKIE", "KUJAWSKO-POMORSKIE", "WARMIŃSKO-MAZURSKIE") ~ "Grupa 2",
      wojewodztwo %in% c("DOLNOŚLĄSKIE", "POMORSKIE", "LUBUSKIE", "ŁÓDZKIE", "OPOLSKIE", "ZACHODNIOPOMORSKIE") ~ "Grupa 3",
      wojewodztwo %in% c("MAZOWIECKIE", "ŚLĄSKIE") ~ "Grupa 4")) %>% 
  melt()%>% left_join(charakterystyka, by = c("variable"="nazwa.skrócona"))%>%  group_by(grupa, kategoria) %>%
  summarise(value = mean(value))

# colnames(wojewodztwaMelt)<-c("grupa","kategoria","poziom zaspokojenia potrzeb")

g <- ggplot(wojewodztwaMelt, aes(x=grupa, y=value, fill=kategoria))
g +  geom_bar(stat="identity", position=position_dodge())+
  scale_fill_brewer(palette="Paired")+
  theme_minimal()

```


Grupa 1 czyli województwo podlaskie, podkarpackie, lubelskie oraz świętokrzyskie charakteryzował najwyższy współczynnik zaspokojenia potrzeb w zakresie ochrony środowiska. Oznacza, że w tych województwach jest najmniej zanieczyszczeń. W województwach tych zanotowano najniższe dochody i wydatki, co przełożyło się na współczynnik zaspokojenia potrzeb w zakresie finansóW.
W grupie 2 czyli województwach małopolskim, wielkopolskim, kujawsko-pomorskim, warmińsko-mazurskim zanotowano najniższej zaspokojone potrzeby w zakresie finansóW i wyżywienia.
Grupa 3 czyli dolnośląskie, pomorskie, lubuskie, łódzkie, opolskie, zachodniopomorskie charakteryzowała się stosunkowo wysokimi wartościami w zakresie finansów czyli wysokimi dochodami, wydatkami i małą liczba gospodarstw domowych dotkniętych ubóstwem.
Grupa 4 czyli mazowieckie, śląskie charakteryzowała się najwyższymi wartościami w zakresie finansów oraz edukacji przy jednocześnie najniższych współczynnikach w zakresie bezpieczeństwa obywateli oraz ochrony środowiska.
